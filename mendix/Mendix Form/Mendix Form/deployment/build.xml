<?xml version="1.0" encoding="utf-8"?>
<project name="Demo7" default="deploy" basedir="..">
  <description>Ant buildfile for deployment. Generated by the Mendix Business Modeler.</description>
  <taskdef name="gzipall" classname="com.mendix.ant.GZipAll" />
  <property name="javasource" location="javasource" />
  <property name="resources" location="resources" />
  <property name="theme" location="theme" />
  <property name="userlib" location="userlib" />
  <property name="widgets" location="widgets" />
  <property name="deployment" location="deployment" />
  <property name="model" location="${deployment}/model" />
  <property name="web" location="${deployment}/web" />
  <property name="tmp" location="${deployment}/tmp" />
  <target name="clean" description="clean the deployment directory">
    <delete dir="${model}" />
    <delete dir="${web}" />
  </target>
  <target name="deploy" description="deploy the project">
    <delete dir="${web}/forms" />
    <unzip src="C:\Program Files (x86)\Mendix\4.4.4\modeler\deployment.mxz" dest="${deployment}" />
    <copy todir="${model}/lib/userlib">
      <fileset dir="${userlib}" />
    </copy>
    <copy todir="${model}/resources">
      <fileset dir="${resources}" />
    </copy>
    <unzip src="${widgets}/LoginSystem.mpk" dest="${web}/widgets" />
    <copy todir="${web}" overwrite="true">
      <fileset dir="${theme}">
        <exclude name="*.zip" />
      </fileset>
    </copy>
  </target>
  <target name="gzip" description="gzip theme and widget files">
    <gzip src="${web}/widgets/widgets.js" destfile="${web}/widgets/widgets.js.gz" />
    <gzip src="${web}/widgets/widgets_mobile.js" destfile="${web}/widgets/widgets_mobile.js.gz" />
    <gzip src="${web}/widgets/widgets.css" destfile="${web}/widgets/widgets.css.gz" />
    <gzip src="${web}/widgets/widgets_mobile.css" destfile="${web}/widgets/widgets_mobile.css.gz" />
    <mkdir dir="${tmp}" />
    <copy todir="${tmp}" overwrite="true">
      <fileset dir="${theme}">
        <exclude name="*.zip" />
      </fileset>
    </copy>
    <gzipall>
      <fileset dir="${tmp}">
        <include name="**/*.css" />
        <include name="**/*.html" />
        <include name="**/*.js" />
      </fileset>
      <fileset dir="${web}">
        <include name="**/*.mxf" />
      </fileset>
    </gzipall>
    <copy todir="${web}" overwrite="true">
      <fileset dir="${tmp}" />
    </copy>
    <delete dir="${tmp}" />
  </target>
  <target name="compile" description="compile Java actions">
    <javac srcdir="${javasource}" destdir="${model}/lib/bin" includeAntRuntime="false" debug="true" debuglevel="lines,source" encoding="UTF-8">
      <classpath>
        <fileset file="C:\Program Files (x86)\Mendix\4.4.4\server/appcontainer.jar" />
        <fileset dir="C:\Program Files (x86)\Mendix\4.4.4\server/lib">
          <include name="*.jar" />
        </fileset>
        <fileset file="C:\Program Files (x86)\Mendix\4.4.4\runtime/mxruntime.jar" />
        <fileset dir="C:\Program Files (x86)\Mendix\4.4.4\runtime/lib">
          <include name="*.jar" />
        </fileset>
        <fileset dir="${userlib}">
          <include name="*.jar" />
        </fileset>
      </classpath>
    </javac>
  </target>
</project>